<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>电池与网络优化-性能优化 | Learn OS concepts by coding them!</title><meta name="keywords" content="性能优化,电池与网络优化,Android"><meta name="author" content="Jack Ou"><meta name="copyright" content="Jack Ou"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="referrer" content="no-referrer"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="本篇文章记录电池与网络优化，其实侧面体现CPU优化，在静默时或者运行时CPU是否运行，后台运行做了什么。">
<meta property="og:type" content="article">
<meta property="og:title" content="电池与网络优化-性能优化">
<meta property="og:url" content="https://oujie123.github.io/2021/11/10/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/index.html">
<meta property="og:site_name" content="Learn OS concepts by coding them!">
<meta property="og:description" content="本篇文章记录电池与网络优化，其实侧面体现CPU优化，在静默时或者运行时CPU是否运行，后台运行做了什么。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/13838098-cdda3865282e1bb4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="article:published_time" content="2021-11-10T15:59:27.000Z">
<meta property="article:modified_time" content="2021-11-15T15:40:21.333Z">
<meta property="article:author" content="Jack Ou">
<meta property="article:tag" content="性能优化">
<meta property="article:tag" content="电池与网络优化">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/13838098-cdda3865282e1bb4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><link rel="shortcut icon" href="https://upload-images.jianshu.io/upload_images/13838098-8a5cd66eafd7c761.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><link rel="canonical" href="https://oujie123.github.io/2021/11/10/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Jack Ou","link":"链接: ","source":"来源: Learn OS concepts by coding them!","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-15 23:40:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://upload-images.jianshu.io/upload_images/13838098-a7dfe0e9d3ed649c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">136</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">99</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分栏</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://upload-images.jianshu.io/upload_images/13838098-cdda3865282e1bb4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Learn OS concepts by coding them!</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分栏</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">电池与网络优化-性能优化</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-10T15:59:27.000Z" title="发表于 2021-11-10 23:59:27">2021-11-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-11-15T15:40:21.333Z" title="更新于 2021-11-15 23:40:21">2021-11-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Android/">Android</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>13分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="1-电池优化"><a href="#1-电池优化" class="headerlink" title="1 电池优化"></a>1 电池优化</h3><p>在车机上，电池是直接与汽车蓄电池相连接的，对车机的应用做电量优化似乎是没有什么意义的，但是我们可以从电量优化的角度来看CPU静默，或者运行时都做了什么，应用做了什么操作让CPU一直在运行，是否后台一直有网络请求等。</p>
<p>在手机上，电池续航时间是移动用户体验中最重要的一个方面。没电的设备完全无法使用。因此，对于应用来说，尽可能地考 虑电池续航时间是至关重要的。在我们开发时对于单个APP做电量优化，主要考虑以下三个方面：</p>
<ul>
<li><strong>减少操作：</strong>您的应用是否存在可删减的多余操作？例如，是否可以缓存已下载的数据，而不是每次重新下载 数据？</li>
<li><strong>推迟操作：</strong>应用是否需要立即执行某项操作？例如，是否可以等到设备充电后或者Wiﬁ连接时（通常情况下使 用移动网络要比WIFI更耗电  ）再将数据备份到云端？</li>
<li><strong>合并操作：</strong>工作是否可以批处理，而不是多次将设备置于活动状态？比如和服务器请求不同的接口获取数 据，部分接口是否可以合并为一个？</li>
</ul>
<h4 id="1-1-Doze低电耗模式和StandBy待机模式"><a href="#1-1-Doze低电耗模式和StandBy待机模式" class="headerlink" title="1.1 Doze低电耗模式和StandBy待机模式"></a>1.1 Doze低电耗模式和StandBy待机模式</h4><p>从 Android 6.0（API 级别 23）开始，Android 引入了两项省电功能，通过管理应用在设备未连接至电源时的行为 方式，帮助用户延长电池寿命。当用户长时间未使用设备时，低电耗模式会延迟应用的后台 CPU 和网络活动，从 而降低耗电量。应用待机模式会延迟用户近期未与之交互的应用的后台网络活动。<br>低电耗模式和应用待机模式管理在 Android 6.0 或更高版本上运行的所有应用的行为，无论它们是否专用于 API 级 别 23。</p>
<h5 id="1-1-1-Doze低电耗模式"><a href="#1-1-1-Doze低电耗模式" class="headerlink" title="1.1.1 Doze低电耗模式"></a>1.1.1 Doze低电耗模式</h5><p>如果设备 未充电、屏幕熄灭、让设备在一段时间内保持不活动状态 ，那么设备就会进入Doze模式。在Doze模式 下，系统会尝试通过限制应用访问占用大量网络和 CPU 资源的服务来节省电量。它还会阻止应用访问网络，并延 迟其作业、同步和标准闹钟。<br>Doze中文是打盹，所以系统会定期退出打盹一小段时间，让应用完成其延迟的活动。在此维护期内，系统会运行 所有待处理的同步、作业和闹钟，并允许应用访问网络。</p>
<p><img src="/2021/11/10/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/blog\source_posts\电池与网络优化-性能优化\doze.png" alt="doze"></p>
<p>随着时间的推移，系统安排维护期的次数越来越少，这有助于在设备未连接至充电器的情况下长期处于不活动状态 时降低耗电量。<br>一旦用户通过移动设备、打开屏幕或连接至充电器唤醒设备，系统就会立即退出低电耗模式，并且所有应用都会恢 复正常活动。</p>
<p>在低电耗模式下，您的应用会受到以下限制：</p>
<ul>
<li>暂停访问网络。</li>
<li>系统忽略PowerManager.WakeLock唤醒锁定。</li>
<li>标准<code>AlarmManager</code>闹钟（包括<code>setExact()</code>和<code>setWindow()</code>）推迟到下一个维护期。<ul>
<li>如果需要设置在设备处于低电耗模式时触发的闹钟，请使用API 23(6.0)提供的setAndAllowWhileIdle()  (一次性闹钟，同set方法)或 setExactAndAllowWhileIdle() （比set方法设 置的精度更高，同setExact）。</li>
<li>使用 setAlarmClock()设置的闹钟将继续正常触发，系统会在这些闹钟触发之前不久退出低电耗模式。</li>
</ul>
</li>
<li>系统不执行 WLAN 扫描。</li>
<li>系统不允许运行同步适配器AbstractThreadedSyncAdapter  (账号同步拉活)。</li>
<li>系统不允许运行<code>JobScheduler</code>。</li>
</ul>
<h5 id="1-1-2-Standby待机模式"><a href="#1-1-2-Standby待机模式" class="headerlink" title="1.1.2 Standby待机模式"></a>1.1.2 Standby待机模式</h5><p>应用待机模式允许系统判定应用在用户未主动使用它时是否处于待机状态。当用户有一段时间未触摸应用并且应用 没有以下表现，则Android系统就会使应用进入空闲状态。</p>
<ul>
<li>应用当前有一个进程在前台运行（作为活动或前台服务，或者正在由其他活动或前台服务使用）。</li>
<li>应用生成用户可在锁定屏幕或通知栏中看到的通知。</li>
</ul>
<p>当用户将设备插入电源时，系统会从待机状态释放应用，允许它们自由访问网络并执行任何待处理的作业和同步。 如果设备长时间处于闲置状态，系统将允许闲置应用访问网络，频率大约每天一次。</p>
<h5 id="1-1-3-白名单"><a href="#1-1-3-白名单" class="headerlink" title="1.1.3 白名单"></a>1.1.3 白名单</h5><p>系统提供了一个可配置的白名单，将部分免除低电耗模式和应用待机模式优化的应用列入其中。 在低电耗模式和应用待机模式期间，列入白名单的应用可以使用网络并保留部分唤醒锁定。不过，列入白名单的应用仍会受到其他限制，就像其他应用一样。例如，列入白名单的应用的作业和同步会延迟（在6.0及以下的设备上），并且其常规<code>AlarmManager</code> 闹钟不会触发。应用可以调用  PowerManager.isIgnoringBatteryOptimizations()  来检查应用当前是否在豁免白名单中。</p>
<p>可以在设置 中的 电池优化手动配置白名单 。另外，系统也提供了一些方法，让应用要求用户将其列入白名单。</p>
<ul>
<li><p>应用可以触发<code>ACTION_IGNORE_BATTERY_OPTIMIZATION_SETTINGS</code> Intent，让用户直接转到电池优化，以便他们在其中添加该应用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tartActivity(<span class="keyword">new</span> Intent(Settings.ACTION_IGNORE_BATTERY_OPTIMIZATION_SETTINGS));</span><br></pre></td></tr></table></figure></li>
<li><p>具有<code>REQUEST_IGNORE_BATTERY_OPTIMIZATIONS</code>权限的应用可以触发一个系统对话框，让用户直接将该应用添加到白名单，而无需转到“设置”。此类应用将通过触发<code>ACTION_REQUEST_IGNORE_BATTERY_OPTIMIZATIONS</code>Intent来触发该对话框。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(Settings.ACTION_REQUEST_IGNORE_BATTERY_OPTIMIZATIONS); intent.setData(Uri.parse(<span class="string">&quot;package:&quot;</span>+getPackageName()));</span><br><span class="line">startActivity(intent);</span><br><span class="line"></span><br><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>


<h3 id="2-在低电耗模式下测试"><a href="#2-在低电耗模式下测试" class="headerlink" title="2 在低电耗模式下测试"></a>2 在低电耗模式下测试</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">启用Doze</span></span><br><span class="line">adb shell dumpsys deviceidle enable</span><br><span class="line"><span class="meta">#</span><span class="bash">强制进入doze模式    (同时还需要关闭屏幕)</span></span><br><span class="line">adb shell dumpsys deviceidle force-idle</span><br><span class="line"><span class="meta">#</span><span class="bash">退出doze模式</span></span><br><span class="line">adb shell dumpsys deviceidle unforce</span><br><span class="line"><span class="meta">#</span><span class="bash">关闭doze</span></span><br><span class="line">adb shell dumpsys deviceidle disable</span><br><span class="line"><span class="meta">#</span><span class="bash">重置设备</span></span><br><span class="line">adb shell dumpsys battery reset</span><br><span class="line"><span class="meta">#</span><span class="bash">查看doze白名单</span></span><br><span class="line">adb shell dumpsys deviceidle whitelist</span><br></pre></td></tr></table></figure>


<h3 id="3-在应用待机模式下测试"><a href="#3-在应用待机模式下测试" class="headerlink" title="3 在应用待机模式下测试"></a>3 在应用待机模式下测试</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">设置断开充电</span></span><br><span class="line">adb shell dumpsys battery unplug</span><br><span class="line"><span class="meta">#</span><span class="bash">进入standby</span></span><br><span class="line">adb shell am set-inactive &lt;packageName&gt; true #退出standby</span><br><span class="line">adb shell am set-inactive &lt;packageName&gt; false #查看是否处于standby</span><br><span class="line">adb shell am get-inactive &lt;packageName&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash">重置</span></span><br><span class="line">adb shell dumpsys battery reset</span><br></pre></td></tr></table></figure>


<h3 id="4-优化手段"><a href="#4-优化手段" class="headerlink" title="4 优化手段"></a>4 优化手段</h3><h4 id="4-1-监控电池电量和充电状态"><a href="#4-1-监控电池电量和充电状态" class="headerlink" title="4.1 监控电池电量和充电状态"></a>4.1 监控电池电量和充电状态</h4><p>为了减少电池续航被我们软件的影响，我们可以通过检查电池状态以及电量来判断是否进行某些操作。比如我们可 以在充电时才进行一些数据上报之类的操作。</p>
<h5 id="4-1-1-获取充电状态"><a href="#4-1-1-获取充电状态" class="headerlink" title="4.1.1 获取充电状态"></a>4.1.1 获取充电状态</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">IntentFilter ifilter = <span class="keyword">new</span> IntentFilter(Intent.ACTION_BATTERY_CHANGED); </span><br><span class="line">Intent batteryStatus = registerReceiver(<span class="keyword">null</span>, ifilter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否正在充电</span></span><br><span class="line"><span class="keyword">int</span> status = batteryStatus.getIntExtra(BatteryManager.EXTRA_STATUS, -<span class="number">1</span>); </span><br><span class="line"><span class="keyword">boolean</span> isCharging = status == BatteryManager.BATTERY_STATUS_CHARGING ||</span><br><span class="line">status == BatteryManager.BATTERY_STATUS_FULL;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 什么方式充电？</span></span><br><span class="line"><span class="keyword">int</span> chargePlug = batteryStatus.getIntExtra(BatteryManager.EXTRA_PLUGGED, -<span class="number">1</span>); <span class="comment">//usb</span></span><br><span class="line"><span class="keyword">boolean</span> usbCharge = chargePlug == BatteryManager.BATTERY_PLUGGED_USB; <span class="comment">//充电器</span></span><br><span class="line"><span class="keyword">boolean</span> acCharge = chargePlug == BatteryManager.BATTERY_PLUGGED_AC;</span><br><span class="line">Log.e(TAG, <span class="string">&quot;isCharging: &quot;</span> + isCharging + <span class="string">&quot; usbCharge: &quot;</span> + usbCharge + <span class="string">&quot; acCharge:&quot;</span> + acCharge);</span><br></pre></td></tr></table></figure>


<h5 id="4-1-2-监控充电状态变化"><a href="#4-1-2-监控充电状态变化" class="headerlink" title="4.1.2 监控充电状态变化"></a>4.1.2 监控充电状态变化</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册广播</span></span><br><span class="line">IntentFilter ifilter = <span class="keyword">new</span> IntentFilter(); <span class="comment">//充电状态</span></span><br><span class="line">ifilter.addAction(Intent.ACTION_POWER_CONNECTED); ifilter.addAction(Intent.ACTION_POWER_DISCONNECTED); <span class="comment">//电量显著变化</span></span><br><span class="line">ifilter.addAction(Intent.ACTION_BATTERY_LOW); <span class="comment">//电量不足</span></span><br><span class="line">ifilter.addAction(Intent.ACTION_BATTERY_OKAY); <span class="comment">//电量从低变回高 </span></span><br><span class="line">powerConnectionReceiver = <span class="keyword">new</span> PowerConnectionReceiver(); registerReceiver(powerConnectionReceiver, ifilter);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PowerConnectionReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123; </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (intent.getAction().equals(Intent.ACTION_POWER_CONNECTED)) &#123;</span><br><span class="line">			Toast.makeText(context, <span class="string">&quot;充电状态：CONNECTED&quot;</span>, Toast.LENGTH_SHORT).show(); </span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (intent.getAction().equals(Intent.ACTION_POWER_DISCONNECTED)) &#123;</span><br><span class="line">			Toast.makeText(context, <span class="string">&quot;充电状态：DISCONNECTED&quot;</span>, Toast.LENGTH_SHORT).show(); </span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (intent.getAction().equals(Intent.ACTION_BATTERY_LOW)) &#123;</span><br><span class="line">			Toast.makeText(context, <span class="string">&quot;电量过低&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (intent.getAction().equals(Intent.ACTION_BATTERY_OKAY)) &#123; </span><br><span class="line">			Toast.makeText(context, <span class="string">&quot;电量从低变回高&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">		&#125; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h5 id="4-1-3-WorkManager"><a href="#4-1-3-WorkManager" class="headerlink" title="4.1.3 WorkManager"></a>4.1.3 WorkManager</h5><p>WorkManager API 是一个针对原有的 Android 后台调度 API 整合的建议替换组件。</p>
<p><img src="/2021/11/10/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/blog\source_posts\电池与网络优化-性能优化\workmanager.png" alt="workmanager"></p>
<p>如果设备在 API 级别 23 或更高级别上运行，系统会使用 JobScheduler。在 API 级别 14-22 上，系统会使用 GcmNetworkManager（如果可用），否则会使用自定义 AlarmManager 和 BroadcastReciever 实现作为备用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Constraints constraints = <span class="keyword">new</span> Constraints.Builder()</span><br><span class="line">						  .setRequiredNetworkType(NetworkType.UNMETERED)  <span class="comment">//Wi-Fi   							  .setRequiresCharging(true) //在设备充电时运行</span></span><br><span class="line">						  .setRequiresBatteryNotLow(<span class="keyword">true</span>) <span class="comment">//电量不足不会运行 </span></span><br><span class="line">						  .build();</span><br><span class="line">OneTimeWorkRequest uploadWorkRequest = <span class="keyword">new</span> OneTimeWorkRequest.Builder(UploadWorker.class)</span><br><span class="line">									   .setConstraints(constraints) </span><br><span class="line">     							    	.build();</span><br><span class="line">WorkManager.getInstance(<span class="keyword">this</span>).enqueueUniqueWork(<span class="string">&quot;upload&quot;</span>, ExistingWorkPolicy.KEEP, uploadWorkRequest);</span><br></pre></td></tr></table></figure>


<h3 id="5-电量消耗监控工具"><a href="#5-电量消耗监控工具" class="headerlink" title="5 电量消耗监控工具"></a>5 电量消耗监控工具</h3><p>长时间监控使用Battery Historian，从整体宏观的看电量下降比较快的地方。详细的定位可以使用Android Studio的Energy Profile工具，查看应用后台和前台能耗比较高的地方。</p>
<h4 id="5-1-Battery-Historian"><a href="#5-1-Battery-Historian" class="headerlink" title="5.1 Battery Historian"></a>5.1 Battery Historian</h4><p>Battery Historian是一个可以了解设备随时间的耗电情况的工具  。在系统级别，该工具以 HTML 的形式可视化来 自系统日志的电源相关事件。在具体应用级别，该工具可提供各种数据，帮助您识别耗电的应用行为。</p>
<p>Battery Historian可以帮助我们查看应用是否具有以下耗电行为：</p>
<ul>
<li>过于频繁地触发唤醒提醒（至少每 10 秒钟一次）。 </li>
<li>持续保留 GPS 锁定。</li>
<li>至少每 30 秒调度一次作业。 至少每 30 秒调度一次同步。 </li>
<li>使用手机无线装置的频率高于预期。</li>
</ul>
<h5 id="5-1-1-使用方法"><a href="#5-1-1-使用方法" class="headerlink" title="5.1.1 使用方法"></a>5.1.1 使用方法</h5><p>如下两份文档：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/google/battery-historian">1.官方推荐使用方法</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/378cf678bdeb">2.电量优化Battery Historian2.0 配置</a></p>
<h5 id="5-1-2-采集手顺"><a href="#5-1-2-采集手顺" class="headerlink" title="5.1.2 采集手顺"></a>5.1.2 采集手顺</h5><blockquote>
<p>1、重置电池数据收集</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys batterystats --reset</span><br></pre></td></tr></table></figure>

<p>2、开启wakeLock唤醒锁信息记录（可选）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys batterystats --enable full-wake-history</span><br></pre></td></tr></table></figure>

<p>3、断开设备与计算机的连接，以便仅消耗设备电池的电量。</p>
<p>4、使用您的应用并执行您想要获取数据的操作；例如，断开 WLAN 连接并将数据发送到云端。</p>
<p>5、重新连接手机。</p>
<p>6、生成报告</p>
<ul>
<li>对于搭载 Android 7.0 及更高版本的设备： adb bugreport &gt; [path/]bugreport.zip</li>
<li>对于搭载 Android 6.0 及更低版本的设备： adb bugreport &gt; [path/]bugreport.txt</li>
</ul>
<p>7、关闭wakeLock统计：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys batterystats --disable full-wake-history</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="5-1-3-报告分析"><a href="#5-1-3-报告分析" class="headerlink" title="5.1.3 报告分析"></a>5.1.3 报告分析</h5><p><strong>step1.  使用系统级视图总览</strong><br>Battery Historian 工具提供各种应用和系统行为的系统级可视化结果，以及它们随时间推移与耗电量的相关性。如图 1 所示，此视图可帮助您诊断和识别应用存在的耗电问题。</p>
<p><img src="/2021/11/10/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/blog\source_posts\电池与网络优化-性能优化\总体电量消耗图.png" alt="总体电量消耗图"></p>
<p>图 1. Battery Historian 显示了影响功耗的系统级事件。 </p>
<p>该图中特别值得注意的是表示电池电量的黑色水平下降趋势线（在 y 轴上进行测量）。例如，在电池电量线的最开始处，大约早上 6:50 时，该图表显示电量出现较为急剧的下降。</p>
<p><strong>step2. 扣细节</strong></p>
<p>图 2 为该部分显示画面的特写图。</p>
<p><img src="/2021/11/10/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/blog\source_posts\电池与网络优化-性能优化\电量陡降特写.png" alt="电量陡降特写"></p>
<p>图 2. Battery Historian 时间轴（大约从早上 6:50 到 7:20）的特写图。<br>在电池电量线的最开始处，随着电池电量的急剧下降，显示画面上显示有三件事正在发生：CPU 正在运行，应用已 获取唤醒锁定，且屏幕已打开。通过这种方式，Battery Historian 可帮助您了解耗电量高时正在发生什么事件。然后，您可以针对应用中的这些行为，研究是否可以进行相关优化。</p>
<p><strong>step3. 查看具体应用的数据</strong></p>
<p>表格提供了关于您的应用的两个数据维度。首先，您可以查找应用的耗电量与其他应用相比的排名位置。为此，请 点击“Tables”下的“Device Power Estimates”表格。</p>
<p><img src="/2021/11/10/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/blog\source_posts\电池与网络优化-性能优化\应用详情.png" alt="应用详情"></p>
<p>图 3. 研究哪些应用的耗电量最大。<br>图 3 中的表格显示，Pug Power 在此设备上的耗电量排名第九，在不属于操作系统的应用中排名第三。这些数据 表明此应用需要更深入的研究。<br>要查找特定应用的数据，在可视化图表左侧下方，在“App Selection”下方的第二个下拉菜单中输入应用的软件包名 称。</p>
<p><img src="/2021/11/10/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/blog\source_posts\电池与网络优化-性能优化\特定应用分析.png" alt="特定应用分析"></p>
<p>图 4. 输入特定的应用以查看其数据。<br>图 5 和图 6 显示了 PugPower 的数据：图 5 显示了具体应用数据的可视化图表，图 6 显示了相应的表格数据。</p>
<p>![pug power](E:\blog\source_posts\电池与网络优化-性能优化\pug power.png)</p>
<p>图 5. 虚构应用 Pug Power 的数据可视化图表。</p>
<p>![pug power chart](E:\blog\source_posts\电池与网络优化-性能优化\pug power chart.png)</p>
<p>图 6. 虚构应用 Pugle Power 的表格数据。</p>
<p>查看可视化图表并没有发现任何显而易见的问题。JobScheduler 行显示应用没有调度作业。SyncManager 行显示 应用尚未执行任何同步操作。</p>
<p>不过，查看表格数据的“唤醒锁定”部分发现，Pug Power 获取了 1 个小时内的唤醒锁定总次数。这种代价高昂的异常行为可能是应用耗电量较高的原因。这条信息有助于开发者专攻优化后可能会大大获益的方面。在这种情况下， 我们需要结合代码考虑为什么应用会获得如此多的唤醒锁定时间？是否可以优化？</p>
<h4 id="5-2-Energy-Proﬁler"><a href="#5-2-Energy-Proﬁler" class="headerlink" title="5.2 Energy Proﬁler"></a>5.2 Energy Proﬁler</h4><p>使用 Android 8.0 及以上版本的设备时，使用Energy Proﬁler 可以了解应用在哪里耗用了不必要的电量。 Energy Proﬁler 会监控 CPU、网络无线装置和 GPS 传感器的使用情况，并直观地显示其中每个组件消耗的电量。还会显 示可能会影响耗电量的系统事件（唤醒锁定、闹钟、作业和位置信息请求）的发生次数。使用Proﬁle 运行App。</p>
<p>![Energy profile](E:\blog\source_posts\电池与网络优化-性能优化\Energy profile.png)</p>
<p>![app detailed](E:\blog\source_posts\电池与网络优化-性能优化\app detailed.png)</p>
<h3 id="6-优化方案"><a href="#6-优化方案" class="headerlink" title="6 优化方案"></a>6 优化方案</h3><h4 id="6-1-网络优化"><a href="#6-1-网络优化" class="headerlink" title="6.1 网络优化"></a>6.1 网络优化</h4><p>正常一条网络请求需要经过的流程是这样：</p>
<ul>
<li>DNS 解析，请求DNS服务器，获取域名对应的 IP 地址；</li>
<li>与服务端建立连接，包括 tcp 三次握手，安全协议同步流程；</li>
<li>连接建立完成，发送和接收数据，解码数据。  </li>
</ul>
<p>这里有明显的三个优化点：</p>
<ul>
<li>直接使用 IP 地址，去除 DNS 解析步骤；</li>
<li>不要每次请求都重新建立连接，复用连接或一直使用同一条连接(长连接)；</li>
<li>压缩数据，减小传输的数据大小。  </li>
</ul>
<h4 id="6-2-DNS优化"><a href="#6-2-DNS优化" class="headerlink" title="6.2 DNS优化"></a>6.2 DNS优化</h4><p>DNS（Domain Name System），它的作用是根据域名查出IP地址，它是HTTP协议的前提，只有将域名正确的解<br>析成IP地址后，后面的HTTP流程才能进行。</p>
<p>DNS 完整的解析流程很长，会先从本地系统缓存取，若没有就到最近的 DNS 服务器取，若没有再到主域名服务器<br>取，每一层都有缓存，但为了域名解析的实时性，每一层缓存都有过期时间。  </p>
<p>传统的DNS解析机制有几个缺点：</p>
<ul>
<li>缓存时间设置得长，域名更新不及时，设置得短，大量 DNS 解析请求影响请求速度；</li>
<li>域名劫持，容易被中间人攻击，或被运营商劫持，把域名解析到第三方 IP 地址，据统计劫持率会达到7%；</li>
<li>DNS 解析过程不受控制，无法保证解析到最快的IP；</li>
<li>一次请求只能解析一个域名  </li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://www.jianshu.com/u/10058d760200">Jack Ou</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://www.jianshu.com/u/10058d760200">https://www.jianshu.com/u/10058d760200</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">此文章版权归Jack Ou所有，如有转载，请註明来自原作者</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">性能优化</a><a class="post-meta__tags" href="/tags/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96/">电池与网络优化</a></div><div class="post_share"><div class="social-share" data-image="https://upload-images.jianshu.io/upload_images/13838098-cdda3865282e1bb4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://upload-images.jianshu.io/upload_images/13838098-2431fc1f0eb1b702.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank"><img class="post-qr-code-img" src="https://upload-images.jianshu.io/upload_images/13838098-2431fc1f0eb1b702.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://upload-images.jianshu.io/upload_images/13838098-ea2cb9b10bc2f743.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank"><img class="post-qr-code-img" src="https://upload-images.jianshu.io/upload_images/13838098-ea2cb9b10bc2f743.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/11/11/%E8%A7%A3%E5%86%B3launcher%E5%81%B6%E5%8F%91%E9%97%AA%E9%80%80%E6%8A%A5libc-so%E5%BA%93%E7%A9%BA%E6%8C%87%E9%92%88%E9%97%AE%E9%A2%98/"><img class="prev-cover" src="https://upload-images.jianshu.io/upload_images/13838098-087c0f1ecf7256b5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">解决launcher偶发闪退报libc.so库空指针问题</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/03/GOS%E4%B8%8EA5888%E8%BD%A6%E6%9C%BA%E6%80%A7%E8%83%BD%E5%8F%82%E6%95%B0%E5%AF%B9%E6%AF%94/"><img class="next-cover" src="https://upload-images.jianshu.io/upload_images/13838098-e1177de6d391bef7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">GOS与A5888车机性能参数对比</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/08/14/Dumpsys命令详细说明/" title="Dumpsys命令详细说明"><img class="cover" src="https://upload-images.jianshu.io/upload_images/13838098-5d55fd74e9c304b9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-14</div><div class="title">Dumpsys命令详细说明</div></div></a></div><div><a href="/2021/08/12/解析dumpsys-cpuinfo/" title="解析dumpsys cpuinfo"><img class="cover" src="https://upload-images.jianshu.io/upload_images/13838098-5d55fd74e9c304b9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-12</div><div class="title">解析dumpsys cpuinfo</div></div></a></div><div><a href="/2021/08/14/解析dumpsys-gfxinfo/" title="解析dumpsys gfxinfo"><img class="cover" src="https://upload-images.jianshu.io/upload_images/13838098-5d55fd74e9c304b9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-14</div><div class="title">解析dumpsys gfxinfo</div></div></a></div><div><a href="/2021/08/14/解析dumpsys-meminfo/" title="解析dumpsys meminfo"><img class="cover" src="https://upload-images.jianshu.io/upload_images/13838098-5d55fd74e9c304b9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-14</div><div class="title">解析dumpsys meminfo</div></div></a></div><div><a href="/2021/08/15/性能优化-分析应用性能/" title="性能优化--分析应用性能"><img class="cover" src="https://upload-images.jianshu.io/upload_images/13838098-cdda3865282e1bb4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-15</div><div class="title">性能优化--分析应用性能</div></div></a></div><div><a href="/2021/08/16/解析cat-proc-meminfo/" title="解析cat /proc/meminfo"><img class="cover" src="https://upload-images.jianshu.io/upload_images/13838098-5d55fd74e9c304b9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-16</div><div class="title">解析cat /proc/meminfo</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://upload-images.jianshu.io/upload_images/13838098-a7dfe0e9d3ed649c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Jack Ou</div><div class="author-info__description">努力成为靠谱之人：凡事有交代，件件有着落，事事有回音</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">136</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">99</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://www.jianshu.com/u/10058d760200"><i class="fad fa-sheep"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/oujie123" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://www.jianshu.com/u/10058d760200" target="_blank" title="简书"><i class="fas fa-book-open"></i></a><a class="social-icon" href="https://blog.csdn.net/u010248147" target="_blank" title="CSDN"><i class="fab fa-microblog"></i></a><a class="social-icon" href="mailto:jackou4work@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">欢迎收看我的博客，很高兴与您一同成长！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%94%B5%E6%B1%A0%E4%BC%98%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text">1 电池优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-Doze%E4%BD%8E%E7%94%B5%E8%80%97%E6%A8%A1%E5%BC%8F%E5%92%8CStandBy%E5%BE%85%E6%9C%BA%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 Doze低电耗模式和StandBy待机模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-Doze%E4%BD%8E%E7%94%B5%E8%80%97%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1.1 Doze低电耗模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-Standby%E5%BE%85%E6%9C%BA%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.1.2 Standby待机模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E7%99%BD%E5%90%8D%E5%8D%95"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.1.3 白名单</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9C%A8%E4%BD%8E%E7%94%B5%E8%80%97%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%B5%8B%E8%AF%95"><span class="toc-number">2.</span> <span class="toc-text">2 在低电耗模式下测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%9C%A8%E5%BA%94%E7%94%A8%E5%BE%85%E6%9C%BA%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%B5%8B%E8%AF%95"><span class="toc-number">3.</span> <span class="toc-text">3 在应用待机模式下测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BC%98%E5%8C%96%E6%89%8B%E6%AE%B5"><span class="toc-number">4.</span> <span class="toc-text">4 优化手段</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E7%9B%91%E6%8E%A7%E7%94%B5%E6%B1%A0%E7%94%B5%E9%87%8F%E5%92%8C%E5%85%85%E7%94%B5%E7%8A%B6%E6%80%81"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 监控电池电量和充电状态</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-1-%E8%8E%B7%E5%8F%96%E5%85%85%E7%94%B5%E7%8A%B6%E6%80%81"><span class="toc-number">4.1.1.</span> <span class="toc-text">4.1.1 获取充电状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-2-%E7%9B%91%E6%8E%A7%E5%85%85%E7%94%B5%E7%8A%B6%E6%80%81%E5%8F%98%E5%8C%96"><span class="toc-number">4.1.2.</span> <span class="toc-text">4.1.2 监控充电状态变化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-3-WorkManager"><span class="toc-number">4.1.3.</span> <span class="toc-text">4.1.3 WorkManager</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%94%B5%E9%87%8F%E6%B6%88%E8%80%97%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7"><span class="toc-number">5.</span> <span class="toc-text">5 电量消耗监控工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-Battery-Historian"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 Battery Historian</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-1-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">5.1.1.</span> <span class="toc-text">5.1.1 使用方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-2-%E9%87%87%E9%9B%86%E6%89%8B%E9%A1%BA"><span class="toc-number">5.1.2.</span> <span class="toc-text">5.1.2 采集手顺</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-3-%E6%8A%A5%E5%91%8A%E5%88%86%E6%9E%90"><span class="toc-number">5.1.3.</span> <span class="toc-text">5.1.3 报告分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-Energy-Pro%EF%AC%81ler"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 Energy Proﬁler</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88"><span class="toc-number">6.</span> <span class="toc-text">6 优化方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 网络优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-DNS%E4%BC%98%E5%8C%96"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 DNS优化</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/11/11/%E8%A7%A3%E5%86%B3launcher%E5%81%B6%E5%8F%91%E9%97%AA%E9%80%80%E6%8A%A5libc-so%E5%BA%93%E7%A9%BA%E6%8C%87%E9%92%88%E9%97%AE%E9%A2%98/" title="解决launcher偶发闪退报libc.so库空指针问题"><img src="https://upload-images.jianshu.io/upload_images/13838098-087c0f1ecf7256b5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="解决launcher偶发闪退报libc.so库空指针问题"/></a><div class="content"><a class="title" href="/2021/11/11/%E8%A7%A3%E5%86%B3launcher%E5%81%B6%E5%8F%91%E9%97%AA%E9%80%80%E6%8A%A5libc-so%E5%BA%93%E7%A9%BA%E6%8C%87%E9%92%88%E9%97%AE%E9%A2%98/" title="解决launcher偶发闪退报libc.so库空指针问题">解决launcher偶发闪退报libc.so库空指针问题</a><time datetime="2021-11-11T03:43:59.000Z" title="发表于 2021-11-11 11:43:59">2021-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/10/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" title="电池与网络优化-性能优化"><img src="https://upload-images.jianshu.io/upload_images/13838098-cdda3865282e1bb4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="电池与网络优化-性能优化"/></a><div class="content"><a class="title" href="/2021/11/10/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" title="电池与网络优化-性能优化">电池与网络优化-性能优化</a><time datetime="2021-11-10T15:59:27.000Z" title="发表于 2021-11-10 23:59:27">2021-11-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/03/GOS%E4%B8%8EA5888%E8%BD%A6%E6%9C%BA%E6%80%A7%E8%83%BD%E5%8F%82%E6%95%B0%E5%AF%B9%E6%AF%94/" title="GOS与A5888车机性能参数对比"><img src="https://upload-images.jianshu.io/upload_images/13838098-e1177de6d391bef7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GOS与A5888车机性能参数对比"/></a><div class="content"><a class="title" href="/2021/11/03/GOS%E4%B8%8EA5888%E8%BD%A6%E6%9C%BA%E6%80%A7%E8%83%BD%E5%8F%82%E6%95%B0%E5%AF%B9%E6%AF%94/" title="GOS与A5888车机性能参数对比">GOS与A5888车机性能参数对比</a><time datetime="2021-11-03T02:07:14.000Z" title="发表于 2021-11-03 10:07:14">2021-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/01/%E8%A7%A3%E5%86%B3%E8%AF%AD%E9%9F%B3%E5%8A%A9%E7%90%86%E6%97%A0%E6%B3%95%E6%89%93%E5%BC%80%E7%A9%BA%E8%B0%83%E5%BA%94%E7%94%A8%E9%97%AE%E9%A2%98/" title="解决语音助理无法打开空调应用问题"><img src="https://upload-images.jianshu.io/upload_images/13838098-9b1947f1aa7aef5c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="解决语音助理无法打开空调应用问题"/></a><div class="content"><a class="title" href="/2021/11/01/%E8%A7%A3%E5%86%B3%E8%AF%AD%E9%9F%B3%E5%8A%A9%E7%90%86%E6%97%A0%E6%B3%95%E6%89%93%E5%BC%80%E7%A9%BA%E8%B0%83%E5%BA%94%E7%94%A8%E9%97%AE%E9%A2%98/" title="解决语音助理无法打开空调应用问题">解决语音助理无法打开空调应用问题</a><time datetime="2021-11-01T02:28:30.000Z" title="发表于 2021-11-01 10:28:30">2021-11-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/25/%E8%81%9A%E5%AA%92%E4%BD%93%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/" title="聚媒体内存问题分析"><img src="https://upload-images.jianshu.io/upload_images/13838098-e1177de6d391bef7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="聚媒体内存问题分析"/></a><div class="content"><a class="title" href="/2021/10/25/%E8%81%9A%E5%AA%92%E4%BD%93%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/" title="聚媒体内存问题分析">聚媒体内存问题分析</a><time datetime="2021-10-25T03:06:08.000Z" title="发表于 2021-10-25 11:06:08">2021-10-25</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://upload-images.jianshu.io/upload_images/13838098-cdda3865282e1bb4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Jack Ou</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://oujie123.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.spacingElementById('content-inner')
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.spacingElementById('content-inner')
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})</script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="true" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script></div></body></html>