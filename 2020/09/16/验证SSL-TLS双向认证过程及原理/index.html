<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>验证SSL/TLS双向认证过程及原理 | Learn OS concepts by coding them!</title><meta name="keywords" content="Android,双向认证"><meta name="author" content="Jack Ou"><meta name="copyright" content="Jack Ou"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="referrer" content="no-referrer"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="此笔记记录验证https双向认证的过程，以及工作原理。">
<meta property="og:type" content="article">
<meta property="og:title" content="验证SSL&#x2F;TLS双向认证过程及原理">
<meta property="og:url" content="https://oujie123.github.io/2020/09/16/%E9%AA%8C%E8%AF%81SSL-TLS%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B%E5%8F%8A%E5%8E%9F%E7%90%86/index.html">
<meta property="og:site_name" content="Learn OS concepts by coding them!">
<meta property="og:description" content="此笔记记录验证https双向认证的过程，以及工作原理。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/13838098-49f52b19777b2d39.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="article:published_time" content="2020-09-16T14:53:53.000Z">
<meta property="article:modified_time" content="2021-09-16T15:52:27.783Z">
<meta property="article:author" content="Jack Ou">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="双向认证">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/13838098-49f52b19777b2d39.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><link rel="shortcut icon" href="https://upload-images.jianshu.io/upload_images/13838098-8a5cd66eafd7c761.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><link rel="canonical" href="https://oujie123.github.io/2020/09/16/%E9%AA%8C%E8%AF%81SSL-TLS%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B%E5%8F%8A%E5%8E%9F%E7%90%86/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Jack Ou","link":"链接: ","source":"来源: Learn OS concepts by coding them!","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-09-16 23:52:27'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://upload-images.jianshu.io/upload_images/13838098-a7dfe0e9d3ed649c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">139</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">100</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分栏</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://upload-images.jianshu.io/upload_images/13838098-49f52b19777b2d39.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Learn OS concepts by coding them!</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分栏</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">验证SSL/TLS双向认证过程及原理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-09-16T14:53:53.000Z" title="发表于 2020-09-16 22:53:53">2020-09-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-09-16T15:52:27.783Z" title="更新于 2021-09-16 23:52:27">2021-09-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Android/">Android</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h4 id="1-SSL-TLS-介绍"><a href="#1-SSL-TLS-介绍" class="headerlink" title="1. SSL/TLS 介绍"></a>1. SSL/TLS 介绍</h4><p>什么是 SSL, 什么是 TLS 呢？官话说 SSL 是安全套接层 (secure sockets layer), TLS 是 SSL 的继任者，叫传输层安全 (transport layer security)。说白点，就是在明文的上层和 TCP 层之间加上一层加密，这样就保证上层信息传输的安全。如HTTP 协议是明文传输，加上 SSL 层之后，就有了雅称 HTTPS。它存在的唯一目的就是保证上层通讯安全的一套机制。它的发展依次经历了下面几个时期，像手机软件升级一样，每次更新都添加或去除功能，比如引进新的加密算法，修改握手方式等。</p>
<p>SSL1.0: 已废除<br>SSL2.0: RFC6176, 已废除<br>SSL3.0: RFC6101, 基本废除<br>TLS1.0: RFC2246, 少数古董服务器仍在使用<br>TLS1.1: RFC4346<br>TLS1.2: RFC5246, 目前已广泛使用<br>TLS1.3: RFC8446<br>下面我们将介绍 TLS1.x 如何保证通讯安全。</p>
<h4 id="2-CA-amp-SSL-server-amp-SSL-client-介绍"><a href="#2-CA-amp-SSL-server-amp-SSL-client-介绍" class="headerlink" title="2. CA &amp; SSL server &amp; SSL client 介绍"></a>2. CA &amp; SSL server &amp; SSL client 介绍</h4><h5 id="2-1-如何保证安全呢？你说安全就安全吗，究竟是怎么实现的呢？绝对安全吗？"><a href="#2-1-如何保证安全呢？你说安全就安全吗，究竟是怎么实现的呢？绝对安全吗？" class="headerlink" title="2.1 如何保证安全呢？你说安全就安全吗，究竟是怎么实现的呢？绝对安全吗？"></a>2.1 如何保证安全呢？你说安全就安全吗，究竟是怎么实现的呢？绝对安全吗？</h5><p>有人的地方就有江湖，有江湖的地方就没有绝对的安全。但 SSL/TLS 确实可以极大程度保证信息安全。<br>下面根据图一 SSL/TLS 工作流来一览实现过程。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/13838098-eb3bfe7004507407.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="SSL_TLS工作流程图.png"></p>
<h5 id="2-1-1-CA-介绍"><a href="#2-1-1-CA-介绍" class="headerlink" title="2.1.1 CA 介绍"></a>2.1.1 CA 介绍</h5><p>CA: 证书授权中心 (certificate authority)<br>它呢，类似于国家出入境管理处一样，给别人颁发护照；<br>也类似于国家工商管理局一样，给公司/企业颁发营业执照。</p>
<p>CA 有两大主要性质：</p>
<p>CA 本身是受信任的（国际认可的）<br>给他受信任的申请对象颁发证书</p>
<blockquote>
<p>和办理护照一样，要确定你的合法身份，你不能是犯罪分子或造反派。当然，你需要被收保护费，同时，CA 机构可以随时吊销你的证书。</p>
</blockquote>
<h5 id="2-1-2-CA-证书长啥样"><a href="#2-1-2-CA-证书长啥样" class="headerlink" title="2.1.2 CA 证书长啥样"></a>2.1.2 CA 证书长啥样</h5><p>其实你的电脑中有一堆证书。你可以看一看嘛：</p>
<p>360 浏览器: 选项/设置-&gt; 高级设置 -&gt; 隐私于安全 -&gt; 管理 HTTPS/SSL 证书 -&gt; 证书颁发机构<br>火狐浏览器: 首选项 -&gt; 高级 -&gt; 证书 -&gt; 查看证书 -&gt; 证书机构<br>chrome浏览器: 设置 -&gt; 高级 -&gt; 管理证书 -&gt; 授权中心<br>ubuntu: /etc/ssl/certs/xxx_CA.pem (或 xxx_Certification_Authority.pem)<br>这些都是 CA 的证书！</p>
<h5 id="2-1-3-CA-的证书-ca-crt-和-SSL-server-的证书-server-crt-是什么关系呢"><a href="#2-1-3-CA-的证书-ca-crt-和-SSL-server-的证书-server-crt-是什么关系呢" class="headerlink" title="2.1.3 CA 的证书 ca.crt 和 SSL server 的证书 server.crt 是什么关系呢"></a>2.1.3 CA 的证书 ca.crt 和 SSL server 的证书 server.crt 是什么关系呢</h5><p>SSL server 自己生成一个私钥/公钥对。server.key/server.pub // 私钥加密，公钥解密！<br>server.pub 生成一个请求文件 server.req. 请求文件中包含有 server 的一些信息，如域名/申请者/公钥等<br>server 将请求文件 server.req 递交给 CA 机构，CA 机构验明正身后，将用 ca.key 和请求文件加密生成 server.crt<br>由于 ca.key 和 ca.crt 是一对，于是 ca.crt 可以用来校验 server.crt.</p>
<p>说明：为了简化 CA 校验证书的过程，本文只介绍了最基本的情况。在实际大多数情况下：</p>
<p>server 端的证书颁发机构 CA 和 client 端的证书颁发机构 CA 通常不同<br>证书实际情况下，可以是证书链，也就是多个上级机构逐级下发证书的链<br>证书校验时，CA 通常可以选择校验证书链的深度，最基础的情况是只校验一级</p>
<h5 id="2-1-4-举例说明"><a href="#2-1-4-举例说明" class="headerlink" title="2.1.4  举例说明"></a>2.1.4  举例说明</h5><p>如果 SSL client 想要校验 SSL server. 那么 SSL server 必须要将他的证书 server.crt 传给 client. 然后 client 用 ca.crt 去校验 server.crt 的合法性。<br>如果 server 是一个钓鱼网站，那么 CA 机构是不会给他颁发合法 server.crt 证书的，这样 client 用 ca.crt 去校验，就会失败。<br>比如：浏览器作为一个 SSL client, 你想访问合法的淘宝网站 <a target="_blank" rel="noopener" href="https://www.taobao.com/">https://www.taobao.com</a>, 结果不慎访问到 <a target="_blank" rel="noopener" href="https://wwww.jiataobao.com/">https://wwww.jiataobao.com</a>, 那么浏览器将会检验到这个假淘宝钓鱼网站的非法性，提醒用户不要继续访问！这样就可以保证 client 的所有 https 访问都是经过安全检查的。</p>
<h5 id="2-2-不认证-amp-单向认证-amp-双向认证"><a href="#2-2-不认证-amp-单向认证-amp-双向认证" class="headerlink" title="2.2 不认证 &amp; 单向认证 &amp; 双向认证"></a>2.2 不认证 &amp; 单向认证 &amp; 双向认证</h5><p><strong>何为 SSL/TLS 单向认证，双向认证？</strong></p>
<p><strong>单向认证</strong>：指的是只有一个对象校验对端的证书合法性<br>通常是客户端来校验服务器的合法性。那么 client 需要一个 ca.crt, 服务器需要 server.crt, server.key</p>
<blockquote>
<p>例如：浏览器校验各个 HTTPS 网站的合法性。如果导航栏有绿色的小锁，说明网站合法；如果是红色小锁，说明该网站证书校验不过。</p>
</blockquote>
<p>也可以是服务器来校验客户端的合法性。那么 server 需要一个 ca.crt, 客户端需要 client.crt, client.key</p>
<blockquote>
<p>例如: 亚马逊物联网平台(AWS IoT) 给每个设备颁发证书，所有设备要想连接上 AWS, 必须使用其提供的客户端证书</p>
</blockquote>
<p>双向认证：指的是相互校验，服务器需要校验每个 client 证书, client 也需要校验服务器证书<br>server 需要 server.key 、server.crt 、ca.crt<br>client 需要 client.key 、client.crt 、ca.crt</p>
<p>不认证：指的是不相互校验证书，但仍然使用 TLS 连接。</p>
<blockquote>
<p>证书校验只是 TLS 连接过程中的一小步，是可以省略的过程</p>
</blockquote>
<h5 id="2-3-证书详细工作流"><a href="#2-3-证书详细工作流" class="headerlink" title="2.3 证书详细工作流"></a>2.3 证书详细工作流</h5><p><img src="https://upload-images.jianshu.io/upload_images/13838098-8a797881c3a0d5b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="证书详细工作流程.png"></p>
<p>1）申请认证：服务器需自己生成公钥私钥对 pub_svr &amp; pri_svr，同时根据 pub_svr 生成请求文件 csr, 提交给 CA 机构，csr 中含有公钥、组织信息、个人信息（域名）等信息。(图一中 server.req 就是 csr 请求文件)</p>
<p>2）审核信息：CA 机构通过线上、线下等多种手段验证申请者提供信息的真实性，如组织是否存在、企业是否合法，是否拥有域名的所有权等。</p>
<p>3）签发证书：如信息审核通过，CA 机构会向申请者签发认证文件：证书。<br>证书包含以下信息：申请者公钥、申请者的组织信息和个人信息、签发机构 CA 的信息、有效时间、证书序列号等信息的明文，同时包含一个签名。<br>签名的产生算法：首先，使用散列函数计算公开的明文信息的信息摘要，然后，采用 CA 的私钥对信息摘要进行加密，密文即签名。（图一中生成 server.crt）</p>
<p>4）返回证书：client 如果请求验证服务器，服务器需返回证书文件。（图一中 handshake 传回 server.crt）</p>
<p>5）client验证证书：client 读取证书中的相关的明文信息，采用相同的散列函数计算得到信息摘要，然后，利用对应 CA 的公钥解密签名数据，对比证书的信息摘要，如果一致，则可以确认证书的合法性，即公钥合法。客户端然后验证证书相关的域名信息、有效时间是否吊销等信息。<br>客户端会内置信任 CA 的证书信息（包含公钥），如果 CA 不被信任，则找不到对应 CA 的证书，证书也会被判定非法。(图一中 check 可选，我们可以选择不验证服务器证书的有效性)</p>
<p>6）秘钥协商：验证通过后，server 和 client 将进行秘钥协商。接下来 server 和 client 会采用对称秘钥加密。(对称加密时间性能优)（图一中 pre-master/change_cipher_spec/encrypted_handshake_message 过程）</p>
<p>7）数据传输：SSL server 和 SSL client 采用对称秘钥加密解密数据。</p>
<h5 id="2-4-SSL-TLS单向认证流程"><a href="#2-4-SSL-TLS单向认证流程" class="headerlink" title="2.4 SSL/TLS单向认证流程"></a>2.4 SSL/TLS单向认证流程</h5><p><img src="https://upload-images.jianshu.io/upload_images/13838098-80b608042419d25d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="单向认证过程.png"></p>
<p><strong>(1) client_hello</strong><br>客户端发起请求，以明文传输请求信息，包含版本信息，加密套件候选列表，压缩算法候选列表，随机数，扩展字段等信息，相关信息如下：</p>
<p>支持的最高 TLS 协议版本 version，从低到高依次 SSLv2, SSLv3, TLSv1, TLSv1.1, TLSv1.2, 当前基本不再使用低于 TLSv1 的版本<br>客户端支持的加密套件 cipher suites 列表， 每个加密套件对应前面 TLS 原理中的四个功能的组合：<br>认证算法 Au (身份验证)<br>密钥交换算法 KeyExchange (密钥协商)<br>对称加密算法 Enc (信息加密)<br>信息摘要 Mac (完整性校验)<br>支持的压缩算法 compression methods 列表，用于后续的信息压缩传输<br>随机数 random_C，用于后续的密钥的生成<br>扩展字段 extensions，支持协议与算法的相关参数以及其它辅助信息等，常见的 SNI 就属于扩展字段，后续单独讨论该字段作用<br><strong>(2) server_hello + server_certificate + sever_hello_done</strong><br>server_hello, 服务端返回协商的信息结果，包括选择使用的协议版本 version，选择的加密套件 cipher suite，选择的压缩算法 compression method、随机数 random_S 等，其中随机数用于后续的密钥协商<br>server_certificates, 服务器端配置对应的证书链，用于身份验证与密钥交换<br>server_hello_done，通知客户端 server_hello 信息发送结束<br><strong>(3) 证书校验</strong><br>证书/证书链的可信性 trusted certificate path，方法如前文所述<br>证书是否吊销 revocation，有两类方式离线 CRL 与在线 OCSP，不同客户端行为会不同<br>有效期 expiry date，证书是否在有效时间范围<br>域名 domain，核查证书域名是否与当前的访问域名匹配 (CN 字段)</p>
<blockquote>
<p>证书校验没有强制的过程，也就是校验严格和校验宽松通常都是可以配置的，由校验端来确定。</p>
</blockquote>
<p><strong>(4) client_key_exchange + change_cipher_spec + encrypted_handshake_message</strong><br>client_key_exchange: 合法性验证通过之后，客户端计算产生随机数字 pre-master，并用证书公钥加密，发送给服务器<br>此时客户端已经获取全部的计算协商密钥需要的信息：两个明文随机数 random_C 和 random_S 与自己计算产生的 pre-master，计算得到协商密钥<br>enc_key=Fuc(random_C, random_S, pre-master)<br>change_cipher_spec: 客户端通知服务器后续的通信都采用协商的通信密钥和加密算法进行加密通信;<br>encrypted_handshake_message: 结合之前所有通信参数的 hash 值与其它相关信息生成一段数据，采用协商密钥 session secret 与算法进行加密，然后发送给服务器用于数据与握手验证<br><strong>(5) change_cipher_spec + encrypted_handshake_message</strong><br>服务器用私钥解密加密的 pre-master 数据，基于之前交换的两个明文随机数 random_C 和 random_S，计算得到协商密钥:enc_key=Fuc(random_C, random_S, pre-master);<br>计算之前所有接收信息的 hash 值，然后解密客户端发送的 encrypted_handshake_message，验证数据和密钥正确性;<br>change_cipher_spec, 验证通过之后，服务器同样发送 change_cipher_spec 以告知客户端后续的通信都采用协商的密钥与算法进行加密通信;<br>encrypted_handshake_message, 服务器也结合所有当前的通信参数信息生成一段数据并采用协商密钥 session secret 与算法加密并发送到客户端;<br><strong>(6) 握手结束</strong><br>客户端计算所有接收信息的 hash 值，并采用协商密钥解密 encrypted_handshake_message，验证服务器发送的数据和密钥，验证通过则握手完成</p>
<p><strong>(7) 加密通信</strong><br>开始使用协商密钥与算法进行加密通信。</p>
<h5 id="2-5-实际-wireshark-分析"><a href="#2-5-实际-wireshark-分析" class="headerlink" title="2.5 实际 wireshark 分析"></a>2.5 实际 wireshark 分析</h5><p><img src="https://upload-images.jianshu.io/upload_images/13838098-4e41b01da66c7ffd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="单向认证校验图.png"></p>
<p>我们搭建的 SSL/TLS 服务器是 192.168.111.100, client 是192.168.111.101. client 需要认证 server 的合法性。<br>我们只看 TLSv1.1 的数据包：<br>第一包 (No. 25) Client Hello 包，即 SSL/TLS 单向认证流程的 (1)<br>第二包 (No. 27) Server Hello 包，包含服务器证书等。即 SSL/TLS 单向认证流程的 (2)<br>第三包 (No. 28) 服务器证书验证完成，同时发送 client key exchange+change cipher spec + encrypted handshake message.即 SSL/TLS 单向认证流程的(4)<br>第四包 (No. 29) 秘钥协商，change cipher spec + encrypted hanshake message.即 SSL/TLS 单向认证流程的 (5)<br>第五包 (No. 30) 握手完成。开始上层数据传输。SSL/TLS 单向认证流程的 (7)</p>
<h5 id="2-6-SSL-TLS-双向认证流程"><a href="#2-6-SSL-TLS-双向认证流程" class="headerlink" title="2.6 SSL/TLS 双向认证流程"></a>2.6 SSL/TLS 双向认证流程</h5><p>和单向认证几乎一样，只是在 client 认证完服务器证书后，client 会将自己的证书 client.crt 传给服务器。服务器验证通过后，开始秘钥协商。</p>
<p><strong>实际 wireshark 分析：</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/13838098-12c27718781f5104.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="双向认证校验图.png"></p>
<p>和单向认证一样:<br>我们搭建的 SSL/TLS 服务器是 192.168.111.100, client是192.168.111.101. client 需要认证 server 的合法性，server 也需要认证 client 的合法性</p>
<p>我们只看 TLSv1.1 的数据包：<br>第一包 (No. 55) Client Hello 包，即 SSL/TLS 单向认证流程的 (1)<br>第二包 (No. 57) Server Hello 包，包含服务器证书等。即 SSL/TLS 单向认证流程的 (2)<br>第三包 (No. 60) 服务器证书验证完成，同时发送客户端的证书 client.crt ,同时包含 client key exchange+change cipher spec + encrypted handshake message. 即 SSL/TLS 单向认证流程的 (4)<br>第四包 (No. 61)<strong>服务器验证客户端证书的合法性。</strong>通过后进行秘钥协商，change cipher spec + encrypted hanshake message.即 SSL/TLS 单向认证流程的 (5)<br>重传包 (No. 62) 由于网络原因，TCP 重传第No. 60 包。<br>第五包 (No. 64) 握手完成，开始上层数据传输。SSL/TLS 单向认证流程的 (7)</p>
<h5 id="2-7-证书等格式说明"><a href="#2-7-证书等格式说明" class="headerlink" title="2.7 证书等格式说明"></a>2.7 证书等格式说明</h5><p><strong>crt/key/req/csr/pem/der 等拓展名都是什么东东？</strong></p>
<p>.crt 表示证书, .key 表示私钥, .req 表示请求文件,.csr 也表示请求文件, .pem 表示 pem 格式，.der 表示 der 格式。</p>
<blockquote>
<p>文件拓展名你可以随便命名，只是为了理解需要而命名不同的拓展名。但文件中的信息是有格式的，和 exe，PE 格式一样。</p>
</blockquote>
<p>证书有两种格式：<code>pem</code> 格式和 <code>der</code> 格式</p>
<p>所有证书，私钥等都可以是 pem, 也可以是 der 格式，取决于应用需要。<br>pem 和 der 格式可以互转:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -in ca.crt -outform DER -out ca.der  # pem -&gt; der</span><br><span class="line">openssl x509 -inform der -in ca.der -out ca.pem   # der -&gt; pem</span><br></pre></td></tr></table></figure>
<p><strong>pem 格式</strong>：经过加密的文本文件，一般有下面几种开头结尾：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line">	or:</span><br><span class="line">-----BEGIN CERTIFICATE REQUEST-----</span><br><span class="line">-----END CERTIFICATE REQUEST-----</span><br><span class="line">	or:</span><br><span class="line">----BEGIN CERTIFICATE-----</span><br><span class="line">-----END CERTIFICATE-----</span><br></pre></td></tr></table></figure>
<p><strong>der 格式</strong>: 经过加密的二进制文件。</p>
<p><strong>如何查看证书中有什么</strong><br>证书中含有 申请者公钥、申请者的组织信息和个人信息、签发机构 CA 的信息、有效时间、证书序列号等信息的明文，同时包含一个签名。如查看百度证书详细信息。</p>
<p>a) 先下载百度证书<br>火狐浏览器访问 <a target="_blank" rel="noopener" href="https://www.baidu.com/">https://www.baidu.com/</a>, 点击左上角绿色小锁，点击向右箭头，点击更多信息，点击查看证书，点击详细信息，点击导出。即可导出百度的证书 baiducom.crt</p>
<p>b) 命令查看证书详细信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -noout -text -in baiducom.crt</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/13838098-25c41f46d905aae8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="命令查看证书.png"></p>
<p>详细信息中，有一个字段： <strong>X509v3 Basic Constraints: CA: FALSE</strong><br>该字段指出该证书是否是 CA 证书，还是一般性的非 CA 证书。详细描述见 <a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc5280.txt">RFC5280#section-4.2.1.9</a>，同时 RFC5280 也详细描述证书工作方式等。</p>
<h5 id="2-8-SSL-TLS-和-OpenSSL-mbedTLS-是什么关系"><a href="#2-8-SSL-TLS-和-OpenSSL-mbedTLS-是什么关系" class="headerlink" title="2.8 SSL/TLS 和 OpenSSL, mbedTLS 是什么关系"></a>2.8 SSL/TLS 和 OpenSSL, mbedTLS 是什么关系</h5><p>SSL/TLS 是一种工作原理，OpenSSL 和 mbedTLS 是 SSL/TLS 的具体实现，很类似于 TCP/IP 协议和 socket 之间的关系。</p>
<h4 id="三-本地生成-SSL-相关文件"><a href="#三-本地生成-SSL-相关文件" class="headerlink" title="三: 本地生成 SSL 相关文件"></a>三: 本地生成 SSL 相关文件</h4><h5 id="3-1-证书生成脚本"><a href="#3-1-证书生成脚本" class="headerlink" title="3.1 证书生成脚本"></a>3.1 证书生成脚本</h5><p>我们自己本地使用 makefile.sh 脚本建立一个CA (ca.crt + ca.key)，用这个 CA 给 server 和 client 分别颁发证书。</p>
<p><strong>makefile.sh</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> * Redistributions <span class="keyword">in</span> binary form must reproduce the above copyright</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   notice, this list of conditions and the following disclaimer <span class="keyword">in</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   documentation and/or other materials provided with the distribution.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * Neither the name of the axTLS project nor the names of its</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   contributors may be used to endorse or promote products derived</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   from this software without specific prior written permission.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;AS IS&quot;</span> AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"></span><br><span class="line"><span class="bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Generate the certificates and keys <span class="keyword">for</span> testing.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="bash">PROJECT_NAME=<span class="string">&quot;TLS Project&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Generate the openssl configuration files.</span></span><br><span class="line">cat &gt; ca_cert.conf &lt;&lt; EOF  </span><br><span class="line">[ req ]</span><br><span class="line">distinguished_name     = req_distinguished_name</span><br><span class="line">prompt                 = no</span><br><span class="line"></span><br><span class="line">[ req_distinguished_name ]</span><br><span class="line"> O                      = $PROJECT_NAME Dodgy Certificate Authority</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt; server_cert.conf &lt;&lt; EOF  </span><br><span class="line">[ req ]</span><br><span class="line">distinguished_name     = req_distinguished_name</span><br><span class="line">prompt                 = no</span><br><span class="line"></span><br><span class="line">[ req_distinguished_name ]</span><br><span class="line"> O                      = $PROJECT_NAME</span><br><span class="line"> CN                     = 192.168.111.100</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt; client_cert.conf &lt;&lt; EOF  </span><br><span class="line">[ req ]</span><br><span class="line">distinguished_name     = req_distinguished_name</span><br><span class="line">prompt                 = no</span><br><span class="line"></span><br><span class="line">[ req_distinguished_name ]</span><br><span class="line"> O                      = $PROJECT_NAME Device Certificate</span><br><span class="line"> CN                     = 192.168.111.101</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">mkdir ca</span><br><span class="line">mkdir server</span><br><span class="line">mkdir client</span><br><span class="line">mkdir certDER</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> private key generation</span></span><br><span class="line">openssl genrsa -out ca.key 2048</span><br><span class="line">openssl genrsa -out server.key 2048</span><br><span class="line">openssl genrsa -out client.key 2048</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> cert requests</span></span><br><span class="line">openssl req -out ca.req -key ca.key -new \</span><br><span class="line">            -config ./ca_cert.conf</span><br><span class="line">openssl req -out server.req -key server.key -new \</span><br><span class="line">            -config ./server_cert.conf </span><br><span class="line">openssl req -out client.req -key client.key -new \</span><br><span class="line">            -config ./client_cert.conf </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> generate the actual certs.</span></span><br><span class="line">openssl x509 -req -in ca.req -out ca.crt \</span><br><span class="line">            -sha1 -days 5000 -signkey ca.key</span><br><span class="line">openssl x509 -req -in server.req -out server.crt \</span><br><span class="line">            -sha1 -CAcreateserial -days 5000 \</span><br><span class="line">            -CA ca.crt -CAkey ca.key</span><br><span class="line">openssl x509 -req -in client.req -out client.crt \</span><br><span class="line">            -sha1 -CAcreateserial -days 5000 \</span><br><span class="line">            -CA ca.crt -CAkey ca.key</span><br><span class="line"> </span><br><span class="line">openssl x509 -in ca.crt -outform DER -out ca.der</span><br><span class="line">openssl x509 -in server.crt -outform DER -out server.der</span><br><span class="line">openssl x509 -in client.crt -outform DER -out client.der</span><br><span class="line"></span><br><span class="line">mv ca.crt ca.key ca/</span><br><span class="line">mv server.crt server.key server/</span><br><span class="line">mv client.crt client.key client/</span><br><span class="line"></span><br><span class="line">mv ca.der server.der client.der certDER/</span><br><span class="line"></span><br><span class="line">rm *.conf</span><br><span class="line">rm *.req</span><br><span class="line">rm *.srl </span><br></pre></td></tr></table></figure>


<p>将上述代码保存为 <strong>makefile.sh</strong><br>做如下修改，终端执行。</p>
<p><strong>- 修改 CN 域中 IP 地址为你主机/设备的 IP 地址</strong><br><strong>- [可选] 加密位数 2048 修改为你需要的加密位数</strong></p>
<p>将会看到：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/13838098-6a51b4e7ae18deb8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="脚本自动生成证书.png"></p>
<p>ca目录：保存 ca 的私钥 ca.key 和证书 ca.crt<br>certDER目录:将证书保存为二进制文件 ca.der, client.der, server.der<br>client目录: client.crt, client.key<br>server目录:server.crt, server.key</p>
<h4 id="3-2-删除脚本"><a href="#3-2-删除脚本" class="headerlink" title="3.2 删除脚本"></a>3.2 删除脚本</h4><p><strong>rmfile.sh</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rm ca/ -rf</span><br><span class="line">rm certDER/ -rf</span><br><span class="line">rm client/ -rf</span><br><span class="line">rm server/ -rf</span><br></pre></td></tr></table></figure>
<p>将上述代码保存为 rmfile.sh, 终端执行，将会删除产生过的目录和文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rmfile.sh</span><br></pre></td></tr></table></figure>


<h4 id="3-3-CA-校验证书测试"><a href="#3-3-CA-校验证书测试" class="headerlink" title="3.3 CA 校验证书测试"></a>3.3 CA 校验证书测试</h4><p>我们可在本地使用 CA 证书来分别校验由自己颁发的服务器证书 server.crt 和客户端证书 client.crt</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">openssl verify -CAfile ca/ca.crt server/server.crt</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">openssl verify -CAfile ca/ca.crt client/client.crt</span></span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/13838098-423fe93728e20aa4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="校验证书.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://www.jianshu.com/u/10058d760200">Jack Ou</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://www.jianshu.com/u/10058d760200">https://www.jianshu.com/u/10058d760200</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">此文章版权归Jack Ou所有，如有转载，请註明来自原作者</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a><a class="post-meta__tags" href="/tags/%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81/">双向认证</a></div><div class="post_share"><div class="social-share" data-image="https://upload-images.jianshu.io/upload_images/13838098-49f52b19777b2d39.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://upload-images.jianshu.io/upload_images/13838098-2431fc1f0eb1b702.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank"><img class="post-qr-code-img" src="https://upload-images.jianshu.io/upload_images/13838098-2431fc1f0eb1b702.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://upload-images.jianshu.io/upload_images/13838098-ea2cb9b10bc2f743.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank"><img class="post-qr-code-img" src="https://upload-images.jianshu.io/upload_images/13838098-ea2cb9b10bc2f743.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/09/19/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81/"><img class="prev-cover" src="https://upload-images.jianshu.io/upload_images/13838098-ce87e3085f3b0299.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">设计模式测试代码</div></div></a></div><div class="next-post pull-right"><a href="/2020/07/28/InitRc%E8%A7%A3%E6%9E%90%E7%89%88/"><img class="next-cover" src="https://upload-images.jianshu.io/upload_images/13838098-cb14d87e1b87a615.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Init.rc文件解析版</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/09/13/双向认证的两种实现方式/" title="双向认证的两种实现方式"><img class="cover" src="https://upload-images.jianshu.io/upload_images/13838098-b688791bf19f1b61.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-13</div><div class="title">双向认证的两种实现方式</div></div></a></div><div><a href="/2021/09/28/使用tcpdump采集网络请求，使用wireshark查看/" title="使用tcpdump采集网络请求，使用wireshark查看"><img class="cover" src="https://upload-images.jianshu.io/upload_images/13838098-b688791bf19f1b61.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-28</div><div class="title">使用tcpdump采集网络请求，使用wireshark查看</div></div></a></div><div><a href="/2021/09/17/优化开机动画-系统优化/" title="优化开机动画-系统优化"><img class="cover" src="https://upload-images.jianshu.io/upload_images/13838098-e1177de6d391bef7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-17</div><div class="title">优化开机动画-系统优化</div></div></a></div><div><a href="/2021/03/19/HIDL-demo实现详细步骤/" title="HIDL demo实现详细步骤"><img class="cover" src="https://upload-images.jianshu.io/upload_images/13838098-ceb8ed2a66722632.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-19</div><div class="title">HIDL demo实现详细步骤</div></div></a></div><div><a href="/2021/01/29/IPC机制-三-ContentProvider、Socket和Binder池/" title="IPC机制(三) -- ContentProvider、Socket和Binder池"><img class="cover" src="https://upload-images.jianshu.io/upload_images/13838098-1a87ca0aa39d75c2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-29</div><div class="title">IPC机制(三) -- ContentProvider、Socket和Binder池</div></div></a></div><div><a href="/2021/01/28/IPC机制-二-Bundle-文件共享-Messager/" title="IPC机制(二) -- Bundle,文件共享,Messager"><img class="cover" src="https://upload-images.jianshu.io/upload_images/13838098-cb14d87e1b87a615.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-28</div><div class="title">IPC机制(二) -- Bundle,文件共享,Messager</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://upload-images.jianshu.io/upload_images/13838098-a7dfe0e9d3ed649c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Jack Ou</div><div class="author-info__description">努力成为靠谱之人：凡事有交代，件件有着落，事事有回音</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">139</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">100</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://www.jianshu.com/u/10058d760200"><i class="fad fa-sheep"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/oujie123" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://www.jianshu.com/u/10058d760200" target="_blank" title="简书"><i class="fas fa-book-open"></i></a><a class="social-icon" href="https://blog.csdn.net/u010248147" target="_blank" title="CSDN"><i class="fab fa-microblog"></i></a><a class="social-icon" href="mailto:jackou4work@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">欢迎收看我的博客，很高兴与您一同成长！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-SSL-TLS-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">1. SSL&#x2F;TLS 介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-CA-amp-SSL-server-amp-SSL-client-%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">2. CA &amp; SSL server &amp; SSL client 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E5%AE%89%E5%85%A8%E5%91%A2%EF%BC%9F%E4%BD%A0%E8%AF%B4%E5%AE%89%E5%85%A8%E5%B0%B1%E5%AE%89%E5%85%A8%E5%90%97%EF%BC%8C%E7%A9%B6%E7%AB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%91%A2%EF%BC%9F%E7%BB%9D%E5%AF%B9%E5%AE%89%E5%85%A8%E5%90%97%EF%BC%9F"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 如何保证安全呢？你说安全就安全吗，究竟是怎么实现的呢？绝对安全吗？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-1-CA-%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.2.</span> <span class="toc-text">2.1.1 CA 介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-2-CA-%E8%AF%81%E4%B9%A6%E9%95%BF%E5%95%A5%E6%A0%B7"><span class="toc-number">2.3.</span> <span class="toc-text">2.1.2 CA 证书长啥样</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-3-CA-%E7%9A%84%E8%AF%81%E4%B9%A6-ca-crt-%E5%92%8C-SSL-server-%E7%9A%84%E8%AF%81%E4%B9%A6-server-crt-%E6%98%AF%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB%E5%91%A2"><span class="toc-number">2.4.</span> <span class="toc-text">2.1.3 CA 的证书 ca.crt 和 SSL server 的证书 server.crt 是什么关系呢</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-4-%E4%B8%BE%E4%BE%8B%E8%AF%B4%E6%98%8E"><span class="toc-number">2.5.</span> <span class="toc-text">2.1.4  举例说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E4%B8%8D%E8%AE%A4%E8%AF%81-amp-%E5%8D%95%E5%90%91%E8%AE%A4%E8%AF%81-amp-%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81"><span class="toc-number">2.6.</span> <span class="toc-text">2.2 不认证 &amp; 单向认证 &amp; 双向认证</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-%E8%AF%81%E4%B9%A6%E8%AF%A6%E7%BB%86%E5%B7%A5%E4%BD%9C%E6%B5%81"><span class="toc-number">2.7.</span> <span class="toc-text">2.3 证书详细工作流</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-SSL-TLS%E5%8D%95%E5%90%91%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B"><span class="toc-number">2.8.</span> <span class="toc-text">2.4 SSL&#x2F;TLS单向认证流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-%E5%AE%9E%E9%99%85-wireshark-%E5%88%86%E6%9E%90"><span class="toc-number">2.9.</span> <span class="toc-text">2.5 实际 wireshark 分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-SSL-TLS-%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B"><span class="toc-number">2.10.</span> <span class="toc-text">2.6 SSL&#x2F;TLS 双向认证流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-7-%E8%AF%81%E4%B9%A6%E7%AD%89%E6%A0%BC%E5%BC%8F%E8%AF%B4%E6%98%8E"><span class="toc-number">2.11.</span> <span class="toc-text">2.7 证书等格式说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-8-SSL-TLS-%E5%92%8C-OpenSSL-mbedTLS-%E6%98%AF%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB"><span class="toc-number">2.12.</span> <span class="toc-text">2.8 SSL&#x2F;TLS 和 OpenSSL, mbedTLS 是什么关系</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89-%E6%9C%AC%E5%9C%B0%E7%94%9F%E6%88%90-SSL-%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">三: 本地生成 SSL 相关文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E8%AF%81%E4%B9%A6%E7%94%9F%E6%88%90%E8%84%9A%E6%9C%AC"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 证书生成脚本</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%88%A0%E9%99%A4%E8%84%9A%E6%9C%AC"><span class="toc-number">4.</span> <span class="toc-text">3.2 删除脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-CA-%E6%A0%A1%E9%AA%8C%E8%AF%81%E4%B9%A6%E6%B5%8B%E8%AF%95"><span class="toc-number">5.</span> <span class="toc-text">3.3 CA 校验证书测试</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/12/01/Selinux%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E%E4%B9%A6/" title="Selinux配置说明书"><img src="https://upload-images.jianshu.io/upload_images/13838098-ceb8ed2a66722632.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Selinux配置说明书"/></a><div class="content"><a class="title" href="/2021/12/01/Selinux%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E%E4%B9%A6/" title="Selinux配置说明书">Selinux配置说明书</a><time datetime="2021-12-01T03:31:19.000Z" title="发表于 2021-12-01 11:31:19">2021-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/29/%E5%BA%94%E7%94%A8APK%E7%98%A6%E8%BA%AB%E8%B0%83%E6%9F%A5%E4%B8%8E%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" title="应用APK瘦身调查与优化方案-性能优化"><img src="https://upload-images.jianshu.io/upload_images/13838098-cdda3865282e1bb4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="应用APK瘦身调查与优化方案-性能优化"/></a><div class="content"><a class="title" href="/2021/11/29/%E5%BA%94%E7%94%A8APK%E7%98%A6%E8%BA%AB%E8%B0%83%E6%9F%A5%E4%B8%8E%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" title="应用APK瘦身调查与优化方案-性能优化">应用APK瘦身调查与优化方案-性能优化</a><time datetime="2021-11-29T07:45:03.000Z" title="发表于 2021-11-29 15:45:03">2021-11-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/29/%E8%A7%A3%E5%86%B3Monkey%E8%BF%87%E7%A8%8B%E4%B8%ADCarService%E5%81%B6%E5%8F%91%E5%B4%A9%E6%BA%83%E9%97%AE%E9%A2%98/" title="解决Monkey过程中CarService偶发崩溃问题"><img src="https://upload-images.jianshu.io/upload_images/13838098-087c0f1ecf7256b5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="解决Monkey过程中CarService偶发崩溃问题"/></a><div class="content"><a class="title" href="/2021/11/29/%E8%A7%A3%E5%86%B3Monkey%E8%BF%87%E7%A8%8B%E4%B8%ADCarService%E5%81%B6%E5%8F%91%E5%B4%A9%E6%BA%83%E9%97%AE%E9%A2%98/" title="解决Monkey过程中CarService偶发崩溃问题">解决Monkey过程中CarService偶发崩溃问题</a><time datetime="2021-11-29T06:18:57.000Z" title="发表于 2021-11-29 14:18:57">2021-11-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/17/%E8%B0%83%E6%9F%A5%E9%A1%B9%E7%9B%AE%E7%B3%BB%E7%BB%9F%E5%9C%A8%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%87%8D%E5%90%AF/" title="调查项目系统在使用过程中重启"><img src="https://upload-images.jianshu.io/upload_images/13838098-1cd12a1be7c1f1a4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="调查项目系统在使用过程中重启"/></a><div class="content"><a class="title" href="/2021/11/17/%E8%B0%83%E6%9F%A5%E9%A1%B9%E7%9B%AE%E7%B3%BB%E7%BB%9F%E5%9C%A8%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%87%8D%E5%90%AF/" title="调查项目系统在使用过程中重启">调查项目系统在使用过程中重启</a><time datetime="2021-11-17T09:06:05.000Z" title="发表于 2021-11-17 17:06:05">2021-11-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/10/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" title="电池与网络优化-性能优化"><img src="https://upload-images.jianshu.io/upload_images/13838098-cdda3865282e1bb4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="电池与网络优化-性能优化"/></a><div class="content"><a class="title" href="/2021/11/10/%E7%94%B5%E6%B1%A0%E4%B8%8E%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" title="电池与网络优化-性能优化">电池与网络优化-性能优化</a><time datetime="2021-11-10T15:59:27.000Z" title="发表于 2021-11-10 23:59:27">2021-11-10</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://upload-images.jianshu.io/upload_images/13838098-49f52b19777b2d39.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Jack Ou</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://oujie123.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.spacingElementById('content-inner')
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.spacingElementById('content-inner')
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})</script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="true" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script></div></body></html>